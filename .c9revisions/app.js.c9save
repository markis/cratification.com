{"ts":1343847004101,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\nvar config = require('./lib/getConfig')\n  , express = require('express')\n  , assetManager = require('connect-assetmanager')\n  , DataProvider = require('./dataprovider').DataProvider\n  , ejs = require('ejs')\n  \n  \nvar app = module.exports = express.createServer(express.logger());\n\n//var assetsMiddleware = assetManager(config.assets);\n\nvar dataprovider = new DataProvider(config.database.server, config.database.port);     \n\n// Configuration\napp.configure(function(){\n    app.use(express.compress()); \n    app.use(express.bodyParser());\n    app.use(express.cookieParser());\n\t//app.use(assetsMiddleware);\n    \n//    app.set('views', __dirname + '/views');\n//    app.register('.html', ejs);\n//    app.set('view engine', 'ejs');\n//    \n    app.use(express.methodOverride());\n    app.use(express.favicon(__dirname + '/public/favicon.ico', {maxAge: 31557600000}));\n    app.use(app.router);\n});\n\napp.configure('development', function(){\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true })); \n  app.use(express.static(__dirname + '/public')); \n});\n\napp.configure('production', function(){\n    app.enable('view cache');\n    app.use(express.errorHandler());\n    app.use(express.static(__dirname + '/public', { maxAge: 31557600000 }));\n});\n\napp.get('*', function(req, res, next) {\n   if (req.cookies.valid !== 'true' && req.url.indexOf('/login') !== 0) {\n       res.redirect('/login');\n   } else {\n        next();   \n   }\n});\n\napp.get('/', function(req, res) {\n    res.sendfile(__dirname + '/views/index.html');\n});\n\napp.get('/view', function(req, res) {\n    res.sendfile(__dirname + '/views/view.html');\n});\n\napp.get('/login', function(req, res) {\n    res.sendfile(__dirname + '/views/login.html');\n});\n\napp.get('/login-failed', function(req, res) {\n    res.sendfile(__dirname + '/views/login-failed.html');\n});\n\napp.post('/login', function(req, res) {\n    if (req.body.password === 'Cr@t3') {\n        res.cookie('valid', 'true', { expires: new Date(Date.now() + 31557600000), httpOnly: true });\n        res.redirect('/');\n    } else {\n        res.redirect('/login-failed'); \n    }\n});\n\napp.post('/animation', function(req, res) {\n    dataprovider.save(req.body, function (err, data) {\n        if (err) {\n            res.json({success:false});\n        } else {\n            res.json({success:true, id:data.id});\n        }\n    });\n});\n\napp.get('/animation/:id', function(req, res) {\n    dataprovider.findById(req.params.id, function (err, data) {\n        if (data && data.animations)\n        {\n            res.json(data.animations);\n        }\n        else\n    \t{\n            res.statusCode = 404;\n        \tres.json([]);\n    \t}\n    });\n});\n\napp.listen(config.port);\nconsole.log(\"Express server listening\");"]],"start1":0,"start2":0,"length1":0,"length2":2717}]],"length":2717}
{"contributors":[],"silentsave":false,"ts":1343847078206,"patch":[[{"diffs":[[0,"outer);\n"],[1,"    \n        app.use(express.errorHandler());\n    app.use(express.static(__dirname + '/public', { maxAge: 31557600000 }));\n"],[0,"});\n\napp"]],"start1":878,"start2":878,"length1":16,"length2":139},{"diffs":[[0,"');\n"],[-1,"    app.use(express.errorHandler());\n    app.use(express.static(__dirname + '/public', { maxAge: 31557600000 }));"],[0,"\n});"]],"start1":1254,"start2":1254,"length1":121,"length2":8}]],"length":2727,"saved":false}
{"ts":1343847081072,"patch":[[{"diffs":[[0,");\n    \n"],[-1,"    "],[0,"    app."]],"start1":883,"start2":883,"length1":20,"length2":16}]],"length":2723,"saved":false}
{"ts":1343847086410,"patch":[[{"diffs":[[0,");\n\n"],[-1,"app.configure('development', function(){\n  app.use(express.errorHandler({ dumpExceptions: true, showStack: true })); \n  app.use(express.static(__dirname + '/public')); \n});\n\napp.configure('production', function(){\n    app.enable('view cache');\n\n});\n\n"],[0,"app."]],"start1":1006,"start2":1006,"length1":258,"length2":8}]],"length":2473,"saved":false}
{"ts":1343847165865,"patch":[[{"diffs":[[0,"ew.html');\n});\n\n"],[1,"//"],[0,"app.get('/login'"]],"start1":1363,"start2":1363,"length1":32,"length2":34},{"diffs":[[0,"ion(req, res) {\n"],[1,"//"],[0,"    res.sendfile"]],"start1":1404,"start2":1404,"length1":32,"length2":34},{"diffs":[[0,"s/login.html');\n"],[1,"//"],[0,"});\n\napp.get('/l"]],"start1":1457,"start2":1457,"length1":32,"length2":34}]],"length":2479,"saved":false}
{"ts":1343847378575,"patch":[[{"diffs":[[0,"   });\n});\n\n"],[1,"app.get('*', function(req, res) {\n    res.sendfile(__dirname + '/views/404.html');\n});\n\n"],[0,"app.listen(c"]],"start1":2396,"start2":2396,"length1":24,"length2":112}]],"length":2561,"saved":false}
{"ts":1343847507938,"patch":[[{"diffs":[[0,");\n\n"],[-1,"app.get('/login-failed', function(req, res) {\n    res.sendfile(__dirname + '/views/login-failed.html');\n});\n\n"],[0,"app."]],"start1":1470,"start2":1470,"length1":117,"length2":8},{"diffs":[[0,"ogin"],[-1,"-failed"],[0,"'); "]],"start1":1721,"start2":1721,"length1":15,"length2":8}]],"length":2445,"saved":false}
