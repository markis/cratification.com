{"ts":1344262317193,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"\nvar config = require('./lib/getConfig')\n  , express = require('express')\n  , assetManager = require('connect-assetmanager')\n  , DataProvider = require('./dataprovider').DataProvider\n  , ejs = require('ejs')\n  \n  \nvar app = module.exports = express.createServer(express.logger());\n\n//var assetsMiddleware = assetManager(config.assets);\n\nvar dataprovider = new DataProvider(config.database.server, config.database.port);     \n\n// Configuration\napp.configure(function(){\n    app.use(express.compress()); \n    app.use(express.bodyParser());\n    app.use(express.cookieParser());\n\t//app.use(assetsMiddleware);\n    \n//    app.set('views', __dirname + '/views');\n//    app.register('.html', ejs);\n//    app.set('view engine', 'ejs');\n//    \n    app.use(express.methodOverride());\n    app.use(express.favicon(__dirname + '/public/favicon.ico', {maxAge: 31557600000}));\n    app.use(app.router);\n    \n    app.use(express.errorHandler());\n    app.use(express.static(__dirname + '/public', { maxAge: 31557600000 }));\n});\n\napp.get('*', function(req, res, next) {\n   if (req.cookies.valid !== 'true' && req.url.indexOf('/login') !== 0) {\n       res.redirect('/login');\n   } else {\n        next();   \n   }\n});\n\napp.get('/', function(req, res) {\n    res.sendfile(__dirname + '/views/index.html');\n});\n\napp.get('/view/:id', function(req, res) {\n    res.sendfile(__dirname + '/views/view.html');\n});\n\napp.get('/login', function(req, res) {\n    res.sendfile(__dirname + '/views/login.html');\n});\n\napp.post('/login', function(req, res) {\n    if (req.body.password === 'Cr@t3') {\n        res.cookie('valid', 'true', { expires: new Date(Date.now() + 31557600000), httpOnly: true });\n        res.redirect('/');\n    } else {\n        res.redirect('/login'); \n    }\n});\n\napp.post('/animation', function(req, res) {\n    dataprovider.save(req.body, function (err, data) {\n        if (err) {\n            console.log(err);\n            res.json({success:false});\n        } else {\n            res.json({success:true, id:data.id});\n        }\n    });\n});\n\napp.get('/animation/:id', function(req, res) {\n    dataprovider.findById(req.params.id, function (err, data) {\n        if (data && data.animations)\n        {\n            res.json(data.animations);\n        }\n        else\n    \t{\n            console.log(err);\n            res.statusCode = 404;\n        \tres.json([]);\n    \t}\n    });\n});\n\n\napp.listen(config.port);\nconsole.log(\"Express server listening\");"]],"start1":0,"start2":0,"length1":0,"length2":2422}]],"length":2422}
